<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright (C) 2022 CLARIN ERIC <clarin@clarin.eu>

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->


<mappingDefinition xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <!-- Rules for 'title' field -->
    <contextAssertionBasedRule label="name">
        <terminal>true</terminal>
        <transformers>
            <transformer field="name" xsi:type="identityTransformer" />
        </transformers>
        <assertions>
            <!-- Concepts -->
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://hdl.handle.net/11459/CCR_C-5428_65670fd6-3426-68ac-8f29-faef6ffd02ce *</conceptPath>
            </assertion>
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://purl.org/dc/terms/title *</conceptPath>
            </assertion>
        </assertions>
    </contextAssertionBasedRule>

    <!-- Rules for 'description' field -->
    <contextAssertionBasedRule label="description">
        <terminal>true</terminal>
        <transformers>
            <transformer field="description" xsi:type="identityTransformer" />
        </transformers>
        <assertions>
            <!-- Concepts -->
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://hdl.handle.net/11459/CCR_C-2520_9eeedfb4-47d3-ddee-cfcb-99ac634bf1db *</conceptPath>
            </assertion>
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://hdl.handle.net/11459/CCR_C-6124_2e45fdf9-ced2-89c9-a09d-b4769e9fede6 *</conceptPath>
            </assertion>
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://purl.org/dc/terms/description *</conceptPath>
            </assertion>
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://purl.org/dc/elements/1.1/description *</conceptPath>
            </assertion>
            <assertion xsi:type="xPathAssertion">
                /cmd:CMD/cmd:Components/cmdp:mods/cmdp:abstract/text()
            </assertion>
        </assertions>
    </contextAssertionBasedRule>

    <!-- Rules for the 'format' field -->
    <contextAssertionBasedRule label="format">
        <terminal>true</terminal>
        <transformers>
            <transformer field="format" xsi:type="identityTransformer" />
        </transformers>
        <assertions>
            <!-- Concepts -->
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://hdl.handle.net/11459/CCR_C-2571_2be2e583-e5af-34c2-3673-93359ec1f7df *</conceptPath>
            </assertion>
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://purl.org/dc/terms/format *</conceptPath>
            </assertion>
        </assertions>
    </contextAssertionBasedRule>

    <!-- Rules for the 'language' field (preferred) -->
    <!--     Preferred concepts -->
    <contextAssertionBasedRule label="language (preferred)">
        <score>10</score>
        <terminal>true</terminal>
        <transformers>
            <transformer field="language" xsi:type="valueMapTransformer" behaviour="replaceOnMatch" regex="false" caseSensitive="false">
                <valueMap>
                    <item source="eng" target="English"/>
                </valueMap>
            </transformer>
        </transformers>
        <assertions>
            <!-- Concepts -->
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://hdl.handle.net/11459/CCR_C-2482_08eded24-4086-7e3f-88e5-e0807fb01e17 *</conceptPath>
            </assertion>
        </assertions>
    </contextAssertionBasedRule>

    <!--     Fallback concepts -->
    <contextAssertionBasedRule label="language (fallback)">
        <terminal>true</terminal>
        <transformers>
            <transformer field="language" xsi:type="valueMapTransformer" behaviour="replaceOnMatch" regex="false" caseSensitive="false">
                <valueMap>
                    <item source="eng" target="English"/>
                </valueMap>
            </transformer>
        </transformers>
        <assertions>
            <!-- Concepts -->
            <assertion xsi:type="conceptPathAssertion">
                <conceptPath>http://purl.org/dc/terms/language *</conceptPath>
            </assertion>
        </assertions>
    </contextAssertionBasedRule>
            
   
    <!-- Rules for the 'subject' field -->
    <contextAssertionBasedRule label="subject">
        <terminal>true</terminal>
        <transformers>
            <transformer field="subject" xsi:type="identityTransformer" />
        </transformers>
        <assertions>
            <!-- xpaths -->
            <assertion xsi:type="xPathAssertion">//cmdp:subject/@olac-language</assertion>
        </assertions>
    </contextAssertionBasedRule>


    <fieldValuesRootProcessor>
        <processor xsi:type="scoreFilterProcessor" fields="language" keepHighestScoring="true" />
        <processor xsi:type="identityProcessor"/>
    </fieldValuesRootProcessor>
</mappingDefinition>
